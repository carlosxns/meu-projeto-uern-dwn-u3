<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Formulário</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main>
      <h1>Cadastro de Cliente V2</h1>

      <a
        href="consultar.php"
        class="btn-primary"
        style="margin-bottom: 20px; display: inline-block"
        >Ver Clientes Cadastrados</a
      >
      <form
        id="cadastroForm"
        action="cadastraCliente.php"
        method="post"
        novalidate
        enctype="multipart/form-data"
      >
        <fieldset>
          <legend>Dados Pessoais:</legend>
          <div>
            <label for="nome">Nome:</label>
            <input
              type="text"
              id="nome"
              name="nome"
              autofocus
              required
              minlength="2"
              maxlength="50"
            />

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required />

            <label for="cpf">CPF:</label>
            <input
              type="text"
              id="cpf"
              name="cpf"
              required
              placeholder="000.000.000-00"
              maxlength="14"
            />

            <label for="telefone">Telefone:</label>
            <input
              type="tel"
              id="telefone"
              name="telefone"
              required
              placeholder="(00) 00000-0000"
              maxlength="15"
            />

            <label for="usuario">Usuário:</label>
            <input
              type="text"
              id="usuario"
              name="usuario"
              required
              placeholder="Mínimo de 5 caracteres"
            />

            <label for="senha">Senha:</label>
            <input
              type="password"
              id="senha"
              name="senha"
              required
              placeholder="Mínimo 8 caracteres com letras, números e símbolos"
            />

            <label for="idade">Idade:</label>
            <input
              type="number"
              id="idade"
              name="idade"
              required
              min="1"
              max="100"
            />

            <label for="datanasc">Data de Nascimento:</label>
            <input type="date" id="datanasc" name="datanasc" />

            <p>
              Sexo:
              <select name="sexo" id="sexo">
                <option value="selecione1">Selecione</option>
                <option value="masculino">Masculino</option>
                <option value="feminino">Feminino</option>
              </select>
            </p>
            <p>
              Estado Civil:
              <select name="estadocivil" id="estadocivil">
                <option value="selecione2">Selecione</option>
                <option value="solteiro">Solteiro</option>
                <option value="casado">Casado</option>
                <option value="divorciado">Divorciado</option>
              </select>
            </p>
            <label for="pais">País:</label>
            <input type="text" id="pais" name="pais" value="Brasil" readonly />
          </div>
        </fieldset>

        <fieldset>
          <legend>Endereço de Entrega:</legend>
          <div>
            <label for="cep">CEP:</label>
            <input
              type="text"
              id="cep"
              name="cep"
              required
              placeholder="00000-000"
              maxlength="9"
            />

            <p>
              Tipo de logradouro:
              <select name="tipologradouro" id="tipologradouro">
                <option value="selecione3">Selecione</option>
                <option value="rua">Rua</option>
                <option value="avenida">Avenida</option>
              </select>
            </p>

            <label for="logradouro">Logradouro:</label>
            <input type="text" id="logradouro" name="logradouro" required />

            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" required />

            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" required />

            <label for="estado">Estado:</label>
            <input type="text" id="estado" name="estado" required />
          </div>
        </fieldset>

        <fieldset>
          <legend>Informações Adicionais:</legend>
          <div>
            <p>
              Seleção de Interesses:
              <select name="interesse[]" id="interesse" multiple size="4">
                <option value="filmes">Filmes</option>
                <option value="informatica">Informática</option>
                <option value="games">Games</option>
                <option value="livros">Livros</option>
                <option value="roupas">Roupas</option>
              </select>
            </p>
            <p>Informações Complementares:</p>
            <textarea name="inforcomple" rows="5" cols="30"></textarea>
            <p>Anexar um ou mais arquivos:</p>
            <p>
              <input type="file" name="arquivos[]" multiple />
            </p>
          </div>
        </fieldset>

        <input type="hidden" name="campooculto" value="atividade2" />
        <button type="submit">Enviar</button>
        <input type="reset" value="Limpar" />
      </form>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("cadastroForm");

        form.addEventListener("submit", (event) => {
          const requiredFields = form.querySelectorAll("[required]");
          for (const field of requiredFields) {
            const label = document.querySelector(`label[for=${field.id}]`);
            const labelText = label
              ? label.textContent.replace(":", "")
              : field.name;

            if (field.value.trim() === "") {
              event.preventDefault(); // Impede o envio
              alert(`O campo "${labelText}" é obrigatório.`);
              field.focus();
              return;
            }
          }

          const usuarioInput = document.getElementById("usuario");
          if (usuarioInput.value.length < 5) {
            event.preventDefault(); // Impede o envio
            alert('O campo "Usuário" deve ter no mínimo 5 caracteres.');
            usuarioInput.focus();
            return;
          }

          const senhaInput = document.getElementById("senha");
          const senhaRegex =
            /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
          if (!senhaRegex.test(senhaInput.value)) {
            event.preventDefault(); // Impede o envio
            alert(
              'A "Senha" deve ter no mínimo 8 caracteres, e incluir letras, números e símbolos (@$!%*?&).'
            );
            senhaInput.focus();
            return;
          }

          // Se chegou aqui, a validação passou!
          alert("Formulário validado! Enviando para o servidor... ✅");
        });

        document.getElementById("cpf").addEventListener("input", (e) => {
          let value = e.target.value.replace(/\D/g, "");
          value = value.replace(/(\d{3})(\d)/, "$1.$2");
          value = value.replace(/(\d{3})(\d)/, "$1.$2");
          value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
          e.target.value = value;
        });

        document.getElementById("telefone").addEventListener("input", (e) => {
          let value = e.target.value.replace(/\D/g, "");
          value = value.replace(/^(\d{2})(\d)/, "($1) $2");
          value = value.replace(/(\d{5})(\d{4})$/, "$1-$2");
          e.target.value = value;
        });

        document.getElementById("cep").addEventListener("input", (e) => {
          let value = e.target.value.replace(/\D/g, "");
          value = value.replace(/^(\d{5})(\d)/, "$1-$2");
          e.target.value = value;
        });
      });
    </script>
  </body>
</html>
